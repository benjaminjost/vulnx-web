"use client";

import { Card, CardContent } from "@/components/ui/card";
import { CVERecord } from "@/models/CVERecord";

interface CVEHeaderProps {
  readonly cve: CVERecord;
}

const getSeverityStyles = (severity: string): string => {
  const severityLower = severity.toLowerCase();

  if (severityLower === "critical") {
    return "bg-status-critical text-status-critical-foreground";
  }
  if (severityLower === "high") {
    return "bg-status-high text-status-high-foreground";
  }
  if (severityLower === "medium") {
    return "bg-status-medium text-status-medium-foreground";
  }
  if (severityLower === "low") {
    return "bg-status-low text-status-low-foreground";
  }
  return "bg-muted text-muted-foreground";
};

export function CVEHeader({ cve }: Readonly<CVEHeaderProps>) {
  const formatAge = (days: number): string => {
    if (days >= 365) {
      const years = Math.floor(days / 365);
      const remainingDays = days % 365;
      return `${years} ${years === 1 ? "year" : "years"}, ${remainingDays} ${remainingDays === 1 ? "day" : "days"} (${days} days)`;
    }
    return `${days} ${days === 1 ? "day" : "days"}`;
  };

  return (
    <Card className="border-border">
      <CardContent className="pt-6">
        <div className="space-y-4">
          <div>
            <h1 className="text-3xl font-bold text-foreground mb-2">
              {cve.cveId}
            </h1>
            <h2 className="text-xl text-muted-foreground">
              {cve.name || cve.product || "N/A"}
            </h2>
          </div>

          {/* CVSS Score and Severity */}
          <div className="flex flex-wrap gap-4 items-center">
            <div className="flex items-center gap-2">
              <span className="text-sm text-muted-foreground">CVSS Score:</span>
              <span className="text-2xl font-bold text-foreground">
                {cve.score.toFixed(1)}
              </span>
            </div>
            <div>
              <span
                className={`inline-flex items-center px-3 py-1 rounded-md text-sm font-semibold ${getSeverityStyles(cve.severity)}`}
              >
                {cve.severity}
              </span>
            </div>
            {cve.hasPoC && (
              <span className="inline-flex items-center px-3 py-1 rounded-md text-sm font-semibold bg-status-critical text-status-critical-foreground">
                PoC Available
              </span>
            )}
            <div className="flex items-center gap-2">
              <span className="text-sm text-muted-foreground">Age:</span>
              <span className="text-lg font-semibold text-foreground">
                {formatAge(cve.ageInDays)}
              </span>
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
