"use client"

import { CVERecord } from "@/models/CVERecord"
import { ColumnDef } from "@tanstack/react-table"

export const columns: ColumnDef<CVERecord>[] = [
  {
    accessorKey: "cveId",
    header: "CVE ID",
    enableSorting: true,
    cell: ({ row }) => (
      <div className="flex items-center gap-2">
        <span className="cve-id font-mono text-sm font-semibold text-[#5E81AC] dark:text-[#88C0D0]">
          {row.getValue("cveId")}
        </span>
      </div>
    ),
  },
  {
    accessorKey: "name",
    header: "Vulnerability",
    enableSorting: true,
    cell: ({ row }) => {
      const name = row.original.name || row.original.product || "N/A"
      return (
        <div className="flex flex-col gap-1">
          <div className="font-medium text-neutral-900 dark:text-neutral-50 max-w-md">
            {name}
          </div>
          {row.original.vendor && (
            <div className="text-xs text-neutral-600 dark:text-neutral-400">
              {row.original.vendor}
            </div>
          )}
        </div>
      )
    },
  },
  {
    accessorKey: "score",
    header: "CVSS Score",
    enableSorting: true,
    sortingFn: (rowA, rowB) => {
      const scoreA = parseFloat(rowA.getValue("score"))
      const scoreB = parseFloat(rowB.getValue("score"))
      return scoreA - scoreB
    },
    cell: ({ row }) => {
      const score = parseFloat(row.getValue("score"))

      return (
        <div className="text-sm text-neutral-900 dark:text-neutral-100">
          <span className="font-semibold">{score.toFixed(1)}</span>
        </div>
      )
    },
  },
  {
    accessorKey: "severity",
    header: "Severity",
    enableSorting: true,
    sortingFn: (rowA, rowB) => {
      const severityOrder: Record<string, number> = {
        critical: 4,
        high: 3,
        medium: 2,
        low: 1,
        unknown: 0,
      }
      const severityA = (rowA.getValue("severity") as string).toLowerCase()
      const severityB = (rowB.getValue("severity") as string).toLowerCase()
      return (severityOrder[severityA] || 0) - (severityOrder[severityB] || 0)
    },
    cell: ({ row }) => {
      const severity = row.getValue("severity") as string
      const severityLower = severity.toLowerCase()

      let badgeColor = "bg-neutral-200 text-neutral-800 dark:bg-neutral-700 dark:text-neutral-200"

      if (severityLower === "critical") {
        badgeColor = "bg-[#BF616A] text-white dark:bg-[#BF616A] dark:text-white"
      } else if (severityLower === "high") {
        badgeColor = "bg-[#D08770] text-white dark:bg-[#D08770] dark:text-white"
      } else if (severityLower === "medium") {
        badgeColor = "bg-[#EBCB8B] text-[#5A4A1F] dark:bg-[#EBCB8B] dark:text-[#2D250F]"
      } else if (severityLower === "low") {
        badgeColor = "bg-[#A3BE8C] text-white dark:bg-[#A3BE8C] dark:text-white"
      }

      return (
        <span className={`inline-flex items-center px-3 py-1 rounded-md text-xs font-semibold ${badgeColor}`}>
          {severity}
        </span>
      )
    },
  },
  {
    accessorKey: "ageInDays",
    header: "Age",
    enableSorting: true,
    sortingFn: (rowA, rowB) => {
      const ageA = rowA.getValue("ageInDays") as number
      const ageB = rowB.getValue("ageInDays") as number
      return ageA - ageB
    },
    cell: ({ row }) => {
      const age = row.getValue("ageInDays") as number
      return (
        <div className="text-sm text-neutral-600 dark:text-neutral-400">
          <span className="font-medium">{age}</span> {age === 1 ? 'day' : 'days'}
        </div>
      )
    },
  },
  {
    accessorKey: "hasPoC",
    header: "PoC",
    enableSorting: true,
    sortingFn: (rowA, rowB) => {
      const pocA = rowA.getValue("hasPoC") as boolean
      const pocB = rowB.getValue("hasPoC") as boolean
      return (pocA ? 1 : 0) - (pocB ? 1 : 0)
    },
    cell: ({ row }) => {
      const hasPoC = row.getValue("hasPoC") as boolean
      return (
        <div className="flex items-center">
          {hasPoC ? (
            <span className="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-semibold bg-[#5E81AC] text-white dark:bg-[#5E81AC] dark:text-white">
              Yes
            </span>
          ) : (
            <span className="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-semibold bg-neutral-200 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300">
              No
            </span>
          )}
        </div>
      )
    },
  },
]
